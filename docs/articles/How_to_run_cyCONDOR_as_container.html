<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to run cyCONDOR as container • cyCONDOR</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to run cyCONDOR as container">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cyCONDOR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cyCONDOR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Prepare_data_for_cyCONDOR_analysis.html">Prepare data for cyCONDOR analysis</a></li>
    <li><a class="dropdown-item" href="../articles/How_to_run_cyCONDOR_as_container.html">How to run cyCONDOR as container</a></li>
    <li><a class="dropdown-item" href="../articles/Data_Loading_and_Transformation.html">Data Loading and Transformation</a></li>
    <li><a class="dropdown-item" href="../articles/Load_a_FlowJo_workspace.html">Load a FlowJo workspace</a></li>
    <li><a class="dropdown-item" href="../articles/Dimensionality_Reduction.html">Dimensionality Reduction</a></li>
    <li><a class="dropdown-item" href="../articles/Clustering_and_cell_annotation.html">Clustering and cell annotation</a></li>
    <li><a class="dropdown-item" href="../articles/Batch_correction.html">Batch correction</a></li>
    <li><a class="dropdown-item" href="../articles/Data_Visualization.html">Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/Differential_Analysis.html">Differential Analysis with cyCONDOR</a></li>
    <li><a class="dropdown-item" href="../articles/Pseudotime_analysis.html">Pseudotime analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Data_Projection.html">Data Projection</a></li>
    <li><a class="dropdown-item" href="../articles/Machine_learning_classifier.html">Machine learning classifier</a></li>
    <li><a class="dropdown-item" href="../articles/Cell_type_prediction.html">Cell type prediction</a></li>
    <li><a class="dropdown-item" href="../articles/Other_utilities.html">Introduction to the condor object and other utilities</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lorenzobonaguro/cyCONDOR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to run cyCONDOR as container</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lorenzobonaguro/cyCONDOR/blob/HEAD/vignettes/How_to_run_cyCONDOR_as_container.Rmd" class="external-link"><code>vignettes/How_to_run_cyCONDOR_as_container.Rmd</code></a></small>
      <div class="d-none name"><code>How_to_run_cyCONDOR_as_container.Rmd</code></div>
    </div>

    
    
<p>The easiest way to get started uning <code>cyCONDOR</code> is by
deploying the <code>Docker</code> container we provide with each release
of the package. This container is based on the <code>Bioconductor</code>
image and start an <code>RStudio</code> server session on your
<code>localhost</code> accessible from any browser.</p>
<p>In this vignette we will cover a few option to deploy our
<code>Docker</code> container in your computing infrastructure. If your
specific situation is not covered do not hesitate to contact us.</p>
<p>First we will show how to install <code>Docker Desktop</code> on any
Windows or Mac machine, we will then cover some basic set-up for the
configuration of <code>Docker</code> in a remote server.</p>
<p>Last we will show how to deploy our <code>Docker</code> container
using <code>Singularity</code> as for safety reasons many research
institutions are not allowing <code>Docker</code> containers in their IT
infrastructure anymore.</p>
<div class="section level2">
<h2 id="run-cycondor-with-docker-desktop-pcmac">Run cyCONDOR with <code>Docker Desktop</code> (PC/Mac)<a class="anchor" aria-label="anchor" href="#run-cycondor-with-docker-desktop-pcmac"></a>
</h2>
<p>Install <code>Docker</code> or another tool to deploy Docker
containers (e.g., <code>Singularity</code>).</p>
<p><em>Note</em>: depending on the operating system follow the
instructions at <a href="https://www.docker.com/" class="external-link uri">https://www.docker.com/</a>, on Windows also the Windows
Subsystem for Linux needs to be installed:</p>
<ol style="list-style-type: decimal">
<li>
<p>Set up the Windows Subsystem for Linux 2 (<code>WSL2</code>) and
any of the available Linux distributions:</p>
<ul>
<li>Install <code>WSL2</code> first following the instructions reported
here: <a href="https://learn.microsoft.com/en-us/windows/wsl/install" class="external-link uri">https://learn.microsoft.com/en-us/windows/wsl/install</a>
</li>
<li>Install <code>Ubuntu</code> or another Linux distribution as
reported here: <a href="https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-10#1-overview" class="external-link uri">https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-10#1-overview</a>
</li>
</ul>
</li>
<li><p>Download and install the latest version of
<code>Docker Desktop</code>.</p></li>
<li>
<p>After starting the software, verify the installation of Docker
Desktop.</p>
<ul>
<li>Open the <code>Ubuntu</code> terminal.</li>
<li>Run:</li>
</ul>
</li>
</ol>
<pre><code>docker info</code></pre>
<p><em>Note</em>: If <code>Docker</code> is installed and running
correctly this will output some basic information on the system, if no
output is produced the installation was not successful.</p>
<p>Since the cause of this malfunction could be extremely diverse, it is
advisable to consult the troubleshooting section of
<code>Docker desktop</code> website (<a href="https://docs.docker.com/desktop/troubleshoot/overview/" class="external-link uri">https://docs.docker.com/desktop/troubleshoot/overview/</a>).</p>
<p>You can now start a <code>Docker</code> container for
<code>cyCONDOR</code> analysis.</p>
<p>First download the latest version of the <code>Docker</code>
image</p>
<pre><code>docker pull lorenzobonaguro/cycondor:v030</code></pre>
<p>Now start the container with the following command (everything in
<code>[]</code> need to be edited by the user).</p>
<pre><code>docker run -dp [YOUR PORT]:8787 ∖         # define the port to use
-e USER=[USER] -e PASSWORD=[PW] ∖         # username and password, can be defined by the user
--name cycondor_analysis ∖                # name of the container
-v [LOCAL DIRECTORY PATH]:/data/ ∖        # directory to mount
lorenzobonaguro/cycondor:030              #name of the docker image</code></pre>
<p>You can now access your <code>RStudio</code> session with any browser
at the address:</p>
<pre><code>http://localhost:[YOUR PORT]</code></pre>
<p>Enter now the selected <code>[USER]</code> and <code>[PW]</code> and
you will have access to <code>Rstudio</code>.</p>
<p>To locate your data click on the <code>...</code> symbol above the
<code>Files</code> tab (see picture below) and type <code>/data</code>
to finally press enter.</p>
<p><br></p>
<p><img src="../reference/figures/open_data.png" alt="drawing" width="500"><em>Exemplary <code>Files</code> windows of the <code>Rstudio</code>
server</em></p>
</div>
<div class="section level2">
<h2 id="run-cycondor-with-docker-on-a-remote-server">Run cyCONDOR with Docker on a remote server<a class="anchor" aria-label="anchor" href="#run-cycondor-with-docker-on-a-remote-server"></a>
</h2>
<p>Please follow the guideline of your institution/organization on how
to access remote servers and how to manage <code>Docker</code>
containers.</p>
<p>Here we give a general introduction on how to <code>ssh</code> to a
remote server.</p>
<p>First log into the remote server by typing in the terminal:</p>
<pre><code><span><span class="va">ssh</span> <span class="op">[</span><span class="va">ServerAddress</span><span class="op">]</span> <span class="op">-</span><span class="va">l</span> <span class="op">[</span><span class="va">username</span><span class="op">]</span></span></code></pre>
<p>Both <code>Mac OS Terminal</code> and <code>Windows PowerShell</code>
can use natively the <code>ssh</code> protocol.</p>
<p>You can now start <code>cyCONDOR Docker</code> container as
previously</p>
<pre><code>docker run -dp [YOUR PORT]:8787 ∖         # define the port to use
-e USER=[USER] -e PASSWORD=[PW] ∖         # username and password
--name cycondor_analysis ∖                # name of the container
-v [LOCAL DIRECTORY PATH]:/data/ ∖        # directory to mount
lorenzobonaguro/cycondor:030              #name of the docker image</code></pre>
<p>The <code>RServer</code> session will now be available at the
following address:</p>
<pre><code>http://[ServerAddress]:[YOURPORT]/</code></pre>
<p><em>Note:</em> This vignette is not intended as an exhaustive
tutorial on how to use <code>Docker</code>, we encourage the reader to
explore <code>Docker</code> functionalists on <a href="https://www.docker.com" class="external-link uri">https://www.docker.com</a>.</p>
</div>
<div class="section level2">
<h2 id="stop-restart-and-delete-a-docker-container">Stop, restart and delete a Docker container<a class="anchor" aria-label="anchor" href="#stop-restart-and-delete-a-docker-container"></a>
</h2>
<p>Once you are done with your work, either on your local machine or on
a remote server you can stop your <code>Docker</code> container.</p>
<p>Stopped container can be started quickly without loss of temporary
data or permanently removed.</p>
<p>To stop your <code>Docker</code> container you first need to identify
the <code>CONTAINER ID</code> of your session, this can be done by
typing in the terminal</p>
<pre><code>docker container ls</code></pre>
<p>This command will generate a list of the running containers, you need
to copy the <code>CONTAINER ID</code> of the one matching with your
<code>--name</code> (e.g. cycondor_analysis)</p>
<p>The container can now be stopped</p>
<pre><code>docker container stop [CONTAINER ID]</code></pre>
<p>To now restart the container simply run</p>
<pre><code>docker contaienr start [CONTAINER ID]</code></pre>
<p>Or alternatively to permanently remove the container</p>
<pre><code>docker container rm [CONTAINER ID]</code></pre>
<p><em>Note:</em> Keep in mind that this operation will only remove the
container, the <code>Docker</code> image will still be available to your
system. If you want to remove also the docker image type
<code>docker image rm [IMAGE NAME]</code>.</p>
</div>
<div class="section level2">
<h2 id="run-cycondor-with-singularity-on-a-remote-server">Run cyCONDOR with Singularity on a remote server<a class="anchor" aria-label="anchor" href="#run-cycondor-with-singularity-on-a-remote-server"></a>
</h2>
<p>Running cyCONDOR <code>Docker</code> container with
<code>Singularity</code> as runtime is possible, first you need to
download cyCONDOR <code>Docker</code> image and convert it to a
<code>.sif</code> file:</p>
<pre><code>singularity pull docker://lorenzobonaguro/cycondor:v030</code></pre>
<p>This command will save the <code>Docker</code> image in the current
working directory.</p>
<p>You can now generate a script to start the singularity container in
the same directory named for example
<code>start_singularity.sh</code>.</p>
<p>Also here everything in <code>[]</code> need to be edited by the
user.</p>
<pre><code>#!/bin/bash

#create temporary file variable
export WORKSPACE=[folder path to store tmp files]

#create temporary folders
[ -d $WORKSPACE ] || mkdir -p $WORKSPACE
cd $WORKSPACE
mkdir run tmp-rstudio-server var-lib-rstudio-server

#create a database config file
printf 'provider=sqlite\ndirectory=/var/lib/rstudio-server\n' &gt; database.conf

#create a secure cookie key file
cd tmp-rstudio-server
uuidgen &gt; secure-cookie-key

#prepare to load the container

PASSWORD='[UserSelectedPassword]' singularity exec \
--bind $WORKSPACE/run:/run,\
$WORKSPACE/var-lib-rstudio-server:/var/lib/rstudio-server,\
$WORKSPACE/tmp-rstudio-server:/tmp/rstudio-server,\
$WORKSPACE/database.conf:/etc/rstudio/database.conf,\
[LOCAL DIRECTORY PATH]:/data/ \
[PathToCyCONDORSifFile] rserver \
--www-address=$(hostname -i) --www-port=[YourPort] \
--auth-none=0 --auth-pam-helper-path=pam-helper --server-data-dir=/var/run/rstudio-server --server-user=[YourUsername] &amp;</code></pre>
<p>To start the container you need now to execute the <code>sh</code>
script</p>
<pre><code>sh ./start_singularity.sh</code></pre>
<p>Similarly to <code>Docker</code> containers the RStudio session will
be available at the address:</p>
<pre><code>http://[ServerAddress]:[YOURPORT]/</code></pre>
</div>
<div class="section level2">
<h2 id="stop-a-singularity-container">Stop a Singularity container<a class="anchor" aria-label="anchor" href="#stop-a-singularity-container"></a>
</h2>
<p>To stop a <code>Singularity</code> container you first need to
identify the <code>[PID]</code> associated to the <code>Rserver</code>
session. You can easily do it by typing in the terminal</p>
<pre><code><span><span class="va">top</span> <span class="op">-</span><span class="va">u</span> <span class="op">[</span><span class="va">YourUsername</span><span class="op">]</span></span></code></pre>
<p>You can now stop the container by typing</p>
<pre><code><span><span class="va">kill</span> <span class="op">[</span><span class="va">PID</span><span class="op">]</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="run-cycondor-on-a-hpc-cluster-as-slurm-job">Run cyCONDOR on a HPC cluster as SLURM Job<a class="anchor" aria-label="anchor" href="#run-cycondor-on-a-hpc-cluster-as-slurm-job"></a>
</h2>
<p>For really big dataset it is possible to run <code>Singularity</code>
containers as <code>SLURM</code> jobs on HPC computer clusters.</p>
<p>To set up your environment follow this detailed guide from the
<code>Rocker</code> project: <a href="https://rocker-project.org/use/singularity.html" class="external-link uri">https://rocker-project.org/use/singularity.html</a>.</p>
<p><em>Note</em>: Mare sure your institution allows interactive session
via <code>SLURM</code>, keep in mind this approach is reserving an
entire node do your work and might interfere with other users.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lorenzo Bonaguro, Charlotte Kroeger, Sophie Mueller, Jacqueline Leidner, Aleksej Frolov, Francesco Elli, Nico Henschel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
